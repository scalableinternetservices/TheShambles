<% provide(:title, 'Search Result') %>
<h1 class="text-center">Search Result for <%= @search_title %></h1>

<div class="text-center">
</div>
<table class="table table-striped table-bordered" id="resultTable">
  <thead>
    <tr>
      <th>Name</th>
      <th>Steam ID</th>
      <th>Price (USD)</th>
      <th>Release date</th>
    </tr>
  </thead>

  <tbody>
    <% @games.each do |game| %>
      <tr>        
        <%  if not game.blank? %>
	<td><a href="/games/<%= game[0] %>"><%= game[1] %></a></td>
	<td><%= link_to game[2], "https://store.steampowered.com/app/#{game[2]}", target: "_blank" %></td>
        <td><%= game[3] %></td>
	<td><%= game[4] %></td>
        <% end %>
      </tr>
    <% end %>
  </tbody>
</table>

<div class="text-center"><button class="btn btn-primary" id="loadMoreResults">Load Mode</button></div>

<br>

<%= link_to 'Go Back to Search Page', search_pages_search_path %>

<script>
var loadable = true;
var processor = <%= processor %>;
var memory = <%= memory %>;
var graphic = <%= graphic %>;
var offset = 100;
var limit = 100;

function htmlEscape(str) {
    return str
        .replace(/&/g, '&amp;')
        .replace(/"/g, '&quot;')
        .replace(/'/g, '&#39;')
        .replace(/</g, '&lt;')
        .replace(/>/g, '&gt;');
}

function htmlUnescape(str){
    return str
        .replace(/&quot;/g, '"')
        .replace(/&#39;/g, "'")
        .replace(/&lt;/g, '<')
        .replace(/&gt;/g, '>')
        .replace(/&amp;/g, '&');
}

$('#loadMoreResults').click(function(e){
    var space = $(this);
    if(loadable){
      $.ajax({
	  'type': 'GET',
	  'url': '/games/loadmoresysreq/' + processor + '/' + memory + '/' + graphic + '/' + offset + '/' + limit,
	  'dataType': 'html',
	  'success': function(data){
	      //space.html(data);
	      if(data == ''){
		loadable = false;
		space.attr('disabled', 'disabled');
	      }
	      $('#resultTable tr:last').after($(htmlUnescape(data)));
	  }
      });
    }
});
</script>
